language: node_js
node_js:
  - node
before_install:
  - npm install --global npm@latest
install:
  - npm ci
cache:
  directories:
    - "$HOME/.npm"
script:
  - npm run lint

  - npm run build:prod

  - npm run test -- hippo --browsers ChromeHeadlessNoSandbox
  - npm run test -- angular --browsers ChromeHeadlessNoSandbox
  - npm run test -- example --browsers ChromeHeadlessNoSandbox

  - sed -i "s/chromeOptions:.*/chromeOptions: { args: ['--headless', '--no-sandbox'] },/g" example/e2e/protractor.conf.js
  - npm run e2e

  - echo "//registry.npmjs.org/:_authToken=$NPM_AUTH_TOKEN" >> "$HOME/.npmrc"

  - cd dist/hippo
  - npm publish --access public

  - cd ../angular
  - npm publish --access public
